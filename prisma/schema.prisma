// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "sqlite"
}

model User {
  id       String @id
  name     String
  email    String @unique
  password String
  position String

  //para aceitar a ser chave estrangeira
  tasksManager Task[]

  teams       TeamsMembers[]
  managerTeam Team[]

  workspaces        WorkspaceMember[]
  managerWorkspaces Workspace[]

  objectivesManager Objective[]

  comments Comment[]
}

model Workspace {
  id           String    @id
  project_name String
  description  String
  createdAt    DateTime  @default(now())
  completedAt  DateTime?

  managerId String?
  manager   User?   @relation(fields: [managerId], references: [id], onDelete: SetNull)

  members WorkspaceMember[]
  teams Team[]
  tasks      Task[]
  objectives Objective[]
}

model WorkspaceMember {
  id String @id

  memberId String
  member   User   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  nameMember String @default("unknown")

  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([memberId, workspaceId])
}

model Team {
  id          String  @id
  name        String
  description String?

  workspaceId String
  workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  managerId String?
  manager   User?          @relation(fields: [managerId], references: [id], onDelete: SetNull)
  members   TeamsMembers[]

  tasks      Task[]
  objectives Objective[]
}

model TeamsMembers {
  id String @id

  memberId   String
  member     User   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  nameMember String @default("unknown")

  teamId String
  team   Team   @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([memberId, teamId])
}

model Task {
  id          String    @id
  title       String
  description String
  status      String
  difficulty  String
  createdAt   DateTime  @default(now())
  completedAt DateTime?

  workspaceId String?
  workspace   Workspace? @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  objectiveId String?
  objectives  Objective? @relation(fields: [objectiveId], references: [id], onDelete: Cascade)

  teamId String?
  team   Team?   @relation(fields: [teamId], references: [id], onDelete: SetNull)

  parentId String?
  parent   Task?   @relation("Subtasks", fields: [parentId], references: [id], onDelete: Cascade)
  subtasks Task[]  @relation("Subtasks")

  comments Comment[]

  managerId String?
  manager   User?   @relation(fields: [managerId], references: [id], onDelete: SetNull)
}

model Objective {
  id          String    @id
  title       String
  description String
  status      String
  difficulty  String
  createdAt   DateTime  @default(now())
  completedAt DateTime?

  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  managerId String?
  manager   User?   @relation(fields: [managerId], references: [id], onDelete: SetNull)

  teamId String?
  team   Team?   @relation(fields: [teamId], references: [id], onDelete: SetNull)

  tasks    Task[]
  comments Comment[]
}

model Comment {
  id        String   @id
  content   String
  createdAt DateTime @default(now())

  authorId String
  author   User   @relation(fields: [authorId], references: [id], onDelete: Cascade)

  taskId String?
  task   Task?   @relation(fields: [taskId], references: [id], onDelete: Cascade)

  objectiveId String?
  objective   Objective? @relation(fields: [objectiveId], references: [id], onDelete: Cascade)
}
